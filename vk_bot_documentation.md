# Документация VKBot 

## Общая информация

Этот скрипт реализует бота для социальной сети VK. 
Бот взаимодействует с пользователями через сообщения и кнопки, помогая находить кандидатов для знакомств на основе заданных критериев (город, пол, возрастной диапазон). 
Пользователи могут сохранять кандидатов в избранное, добавлять в чёрный список или сбрасывать критерии поиска.

## Содержимое файла

Скрипт структурирован на несколько ключевых компонентов:
1. **Импорты и зависимости**
    Используются библиотеки: os, dotenv, vk_api и другие.
    Пользовательские модули:
    models (например, Favourites) для работы с базой данных.
    data_base для управления параметрами пользователей, избранным и чёрным списком.
    func_vk для работы с данными VK (например, данные пользователей, фотографии, ссылки).

2. **Класс VKBot**
    Инкапсулирует функционал бота.

3. **Главная функция**
    Точка входа в программу, где бот инициализируется и запускается.


## Зависимости

### Библиотеки
    os: Для работы с переменными окружения.
    dotenv: Для загрузки переменных окружения из файла .env.
    vk_api: Для взаимодействия с API VK.
    random: Для генерации случайных ID сообщений.
    Пользовательские модули (models, data_base, func_vk).

### Внешние требования
    Файл .env, содержащий токен сообщества VK под ключом COMMUNITY_TOKEN.

## Класс VKBot
    Класс VKBot определяет функционал бота, включая взаимодействие с пользователями, обработку сообщений и управление кандидатами.

### Инициализация
    VKBot.__init__(self, token)

        Параметры:
            token: Токен сообщества VK для доступа к API.
        Назначение:
            Инициализация сессии VK API, экземпляра VkLongPoll для прослушивания событий и трекера состояния пользователей (user_states).

### Методы
write_msg(user_id, message, keyboard=None)
    Отправляет сообщение пользователю.
    Параметры:
        user_id: ID пользователя VK.
        message: Текст сообщения.
        keyboard (необязательно): Объект клавиатуры VK для интерактивных кнопок.

Создание клавиатур
    create_keyboard_start: Клавиатура с кнопкой "Начать".
    create_keyboard_options: Клавиатура для управления кандидатами (избранное, пропуск и т.д.).
    create_keyboard_reset: Клавиатура с кнопкой "Сбросить".

handle_user_input(event)
    Обрабатывает сообщения пользователей и переключение состояний.
    Параметры:
        event: Событие VK API, содержащее сообщение пользователя и данные.

    Функционал:
        Управляет состояниями пользователя (например, "start", "city", "sex", "age", "search").
        Направляет пользователей через процесс задания критериев поиска.
        Обрабатывает специальные команды (например, "Сбросить", "Избранные", "Чёрный список").

show_candidate(user_id)
    Отображает кандидата на основе критериев поиска пользователя.
    Параметры:
        user_id: ID пользователя VK.
    Функционал:
        Получает кандидатов с помощью функции get_data_persons.
        Отображает имя, фотографии и ссылку на профиль кандидата.

show_favourites(user_id)
    Показывает список пользователей, сохранённых в избранное.
    Параметры:
        user_id: ID пользователя VK.

## Взаимодействие с базой данных

### Импортируемые функции
    add_or_save_param_user: Сохраняет параметры поиска пользователя в базе данных.
    add_favourite: Добавляет кандидата в избранное.
    add_blacklist: Добавляет кандидата в чёрный список.
    check_favourite_or_blacklist_db: Проверяет, находится ли кандидат в избранном или чёрном списке.
    session: Экземпляр сессии базы данных для выполнения запросов.

### Импортируемые модели
    Favourites: Представляет избранных кандидатов в базе данных.

## Вспомогательные функции (из func_vk)
    get_data_persons: Получает потенциальных кандидатов на основе критериев поиска.
    get_photos_person: Получает фотографии кандидата.
    url_image_and_likes: Обрабатывает фотографии для получения URL и количества лайков.
    get_url_person: Формирует ссылку на профиль VK кандидата.
    check_city_exists: Проверяет, существует ли указанный город.

## Основная функция
    run_bot(bot)  
    Запускает бота и обрабатывает входящие сообщения VK.
        Параметры:
            bot: Экземпляр класса VKBot.

        Цикл:
            Непрерывно прослушивает новые сообщения через VkLongPoll.
            Обрабатывает исключения, чтобы бот оставался рабочим.

## Точка входа
if __name__ == "__main__":
    dotenv.load_dotenv()
    community_token = os.getenv("COMMUNITY_TOKEN")
    bot = VKBot(token=community_token)
    run_bot(bot)

    Загружает токен сообщества из переменных окружения.
    Инициализирует и запускает бота.

## Обработка ошибок
    Ошибки во время выполнения обрабатываются в функции run_bot и выводятся в консоль.

## Использование
    Настройте файл .env с токеном COMMUNITY_TOKEN.
    Убедитесь, что все зависимости и пользовательские модули (models, data_base, func_vk) реализованы.
    Запустите скрипт: python bot_script.py.